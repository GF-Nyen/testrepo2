---
title: "ExploringHemi"
output: html_document
date: "2023-08-18"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}

library('tidyverse')

library(sf)

library(janitor)

```
```{r "glmmTMB"}
#adam said that this package would be the best (glmmTMB)
library("glmmTMB")
library("lme4")
library("nlme")

```

```{r}
test <- read.csv("C:/Users/gn238/OneDrive - Mississippi State University/hemispherical_photos/XLSCanopy_T1.csv")
test2 <- read.csv("C:/Users/gn238/OneDrive - Mississippi State University/hemispherical_photos/hemisans1.csv")



colnames_data <- c("Photo#", "FileName", "Analysis Date Time", "Acquisition Date Time", 
  "Modified Date Time", "ImageSize H V PxSizeH PxSizeV", "Edited Sharpened ChromAberRemoval_RGB", 
  "Camera Make Model Software", "LensFocLength [Equiv. 35mm]", 
  "Aperture", "ExposureTime", "Camera ISO Metering", "Camera Exposure Prog. Bias Mode", 
  "Camera Gain Contrast Saturation Sharpness", "UserCameraModel-SN LensModel-SN", 
  "FOVMax", "LensType LensCalCoef[0 to 9]", "HemiRadiusCentreHV/CoverExtCoef", 
  "GapSizeDist Method Params", "Bonhom ViewAng Span", "LAI2000 NRing PathLengthSubs", 
  "LAISphereProjCoef LAIUsedForG(z)", "NSky NZen NOrien[Orig] ZenMin ZenMax DifRadModel", 
  "GapFrZeroSubs PxOrGap", "ZenithRingsRange", "NofMask", "RadiationUnits", 
  "TimeZone", "MinutesInterval", "GrowSeasActive Begin End DayInt", 
  "SubstDirRad DiffRad", "Index[NDVI] Definition", "Index[NDVI]Total", 
  "Index[NDVI]Avg", "Index[NDVI]Min", "Index[NDVI]Max", NA, NA, 
  NA, "SolarConstant PARToRadRatio DiffRadToDirRadRatio AtmTrans SunSizeMeth", 
  "Channel NBits", "PxClassifMeth PxClassifModif", "FieldTripDate", 
  "FieldTripSite", "FieldTripOpAssist", "AcquisitionTime", "MemoryCard", 
  "CameraHeight", "Plot", "SkyCond", "Analyst", "Comment", "Slope Aspect", 
  "NorthRef Declination[Negative=W]", "Orientation", "Latitude[<0=S]", 
  "Longitude[<0=W]", "Altitude", "CrownProjArea(CPA)", "GapFraction", 
  "Openness", "LAI(Bonhom)-Lin", "LAI(2000)-Lin", "LAI(2000G)-Lin", 
  "LAI(Sphere)-Lin", "LAI(Ellips)-Lin", "MeanLeafAngle-Lin", "LAI(Bonhom)-Log", 
  "LAI(2000)-Log", "LAI(2000G)-Log", "LAI(Sphere)-Log", "LAI(Ellips)-Log", 
  "MeanLeafAngle-Log", "NofZeroGapFrRgn", "CI(Bonhom)", "CI(2000)", 
  "CI(2000G)", "CI(Sphere)", "CI(Ellips)", "CI(GSD)", "CrownCoverRatio", 
  "FoliageCoverRatio", "CrownPorosity", "LAIAtZenViewAngle", "LAIBeerLambert", 
  "LAI(Bonhom)-Lin CICorr", "LAI(2000)-Lin CICorr", "LAI(2000G)-Lin CICorr", 
  "LAI(Sphere)-Lin CICorr", "LAI(Ellips)-Lin CICorr", "LAI(Bonhom)-Log CICorr", 
  "LAI(2000)-Log CICorr", "LAI(2000G)-Log CICorr", "LAI(Sphere)-Log CICorr", 
  "LAI(Ellips)-Log CICorr", "SilhouetteArea(SA)/FoliageA", "CrownArea(CA)/TotGapA", 
  "FrameArea(PFA)/ImageA", "LAI IsolTree/FoliageCover", "DirectSiteFactor",
  "IndirectSiteFactor", "TotalSiteFactor", "PPFDDirectOverPerDay[MJorMol/m2day]", 
  "PPFDDiffuseOverPerDay[MJorMol/m2day]", "PPFDTotalOverPerDay[MJorMol/m2day]", 
  "PPFDDirectUnderPerDay[MJorMol/m2day]", "PPFDDiffuseUnderPerDay[MJorMol/m2day]", 
  "PPFDTotalUnderPerDay[MJorMol/m2day]", "GapRgnArea", "GapRgnZen", 
  "GapRgnAz", "GapRgnHeight", "GapRgnGapFrac", "GapRgnDirRadOver", 
  "GapRgnDirRadUnder", "GapRgnDifRadOver", "GapRgnDifRadUnder", 
  "...")

data <- read_csv("C:/Users/gn238/OneDrive - Mississippi State University/hemispherical_photos/hemisans1.csv", skip = 6, col_names = colnames_data)

data2 <- read_csv("C:/Users/gn238/OneDrive - Mississippi State University/hemispherical_photos/hemisans1.csv", skip = 6, col_names = colnames_data)

```

```{r "importing data and packages and a little cleaning"}


# this is for the jones center #       setwd("R:/graduate_students/Nyen/R - Copy/r_pull_from")
setwd("C:/Users/gn238/OneDrive - Mississippi State University/R - Copy/r_pull_from")

regendatarmd <- read.csv("C:/Users/gn238/OneDrive - Mississippi State University/R - Copy/r_pull_from/regenplots.csv")
#clean the data #take off the quadrat numbers and pool into sampling pints
  
regendatarmd <- regendatarmd   %>% 
  separate(col = PLOT_ID,  into = c("stand", "transect", "position")) %>% 
  janitor::clean_names()

regendatarmd$standbyrow <- paste(regendatarmd$stand, "_", regendatarmd$row)

new_summary <- regendatarmd %>% 
  group_by(stand, transect, position, row, quadrat) %>% 
  summarise(n_seedlings  = length(position[regen_count>=1]),
            mean_height = mean(height_cm))

poolposition <- new_summary <- regendatarmd %>% 
  group_by(stand, transect, position, row) %>% 
  summarise(n_seedlings  = length(position[regen_count>=1]),
            mean_height = mean(height_cm))


```

```{r "do the same seperation of collums for stands for the canopy stuff"}
hemidata <- data2 %>% 
  separate(col = Plot, into = c("stand", "transect", "position")) %>% 
  janitor::clean_names()

hemidata <- hemidata %>%  
    mutate(stand = as.numeric(stand))
hemidata <- hemidata %>%  
    mutate(transect = as.numeric(transect))
hemidata <- hemidata %>%  
    mutate(position = as.character(position))


regendatarmd <- regendatarmd %>%  
    mutate(stand = as.numeric(stand))
regendatarmd <- regendatarmd %>%  
    mutate(transect = as.numeric(transect))
regendatarmd <- regendatarmd %>%  
    mutate(position = as.character(position))


new_summary <- new_summary %>%  
    mutate(stand = as.numeric(stand))
new_summary <- new_summary %>%  
    mutate(transect = as.numeric(transect))
new_summary <- new_summary %>%  
    mutate(position = as.character(position))

poolposition <- poolposition %>%  
    mutate(stand = as.numeric(stand))
poolposition <- poolposition %>%  
    mutate(transect = as.numeric(transect))
poolposition <- poolposition %>%  
    mutate(position = as.character(position))


```



```{r "make some summary tables of the hemidata}
bigdat <- new_summary %>% full_join(hemidata, by = c("stand", "transect", "position"))
pooldat <- poolposition %>% full_join(hemidata, by = c("stand", "transect", "position"))
data3 <- rename(data2, "photo_number" = "Photo#" )
data2 <- as_tibble(data2)                 
       


poolsum <- pooldat %>% 
  group_by(stand, transect, position) %>% 
    reframe(n_seedlings, mean_height, gap_fraction, openness, lai_2000_lin , ppfd_total_under_per_day_m_jor_mol_m2day )

#important ---------------
bigbigdat <- left_join(data3, bigdat, by = "photo_number")
#IMPORTANT ---------------


hemisum <- bigdat %>% 
  group_by(stand, transect, position) %>% 
    reframe(n_seedlings, mean_height, gap_fraction, openness, lai_2000_lin , ppfd_total_under_per_day_m_jor_mol_m2day )


histdata <- hemisum %>% 
  group_by(stand, transect, position) %>% 
    reframe(hemisum[which(hemisum$n_seedlings>0),], mean_height, gap_fraction, openness, lai_2000_lin , ppfd_total_under_per_day_m_jor_mol_m2day )

```



```{r "lets get grapphy"}

ggplot(hemisum[which(hemisum$n_seedlings>0),],aes(ppfd_total_under_per_day_m_jor_mol_m2day, n_seedlings))+
  geom_point() +
    geom_smooth(method = "lm", se=F)
    
ggplot(hemisum[which(hemisum$n_seedlings>0),],aes(ppfd_total_under_per_day_m_jor_mol_m2day, n_seedlings))+
  geom_point() +
    geom_smooth(se=F)      

ggplot(hemisum[which(hemisum$n_seedlings>0),],aes(gap_fraction, n_seedlings))+
  geom_point() +
    geom_smooth(se=F)
ggplot(hemisum, aes(gap_fraction, n_seedlings))+
  geom_point() +
    geom_smooth(se=F)



ggplot(hemisum[which(hemisum$n_seedlings>0),],aes(gap_fraction, n_seedlings))+
  geom_point() +
    geom_smooth(method = "lm", se=F)

ggplot(hemisum[which(hemisum$n_seedlings>0),],aes(openness, n_seedlings))+
  geom_point() +
    geom_smooth(se=F)

ggplot(hemisum[which(hemisum$n_seedlings>0),],aes(openness, n_seedlings))+
  geom_point() +
    geom_smooth(method = "lm", se=F)

ggplot(hemisum[which(hemisum$n_seedlings>0),],aes(lai_2000_lin, n_seedlings))+
  geom_point() +
    geom_smooth(se=F)

```

```{r "how about some occurance histograms"}

ggplot(poolsum, aes(x=openness)) +
    geom_histogram(bins=10)
    
ggplot(poolsum[which(hemisum$n_seedlings>0),], aes(x=openness)) +
    geom_histogram(bins=25)



```
```{r "Started to use Poisson GLM distributions?"}
# Dpark is x -- n_seedlings
#TotN is y -- Openness

#plot(poolsum$openness, poolsum$n_seedlings, xlab ="Number of Seedlings", ylab = "Canopy Openness")

#M1 <- glm(n_seedlings ~ openness, family = poisson, data = poolsum)
#poolsum %>% glm(formula = openness ~ n_seedlings, family = poisson)
#summary(M1)

#explanatory_data <- poolsum %>% 
 #   select(openness)

#predict(M1, explanatory_data)

#residuals(M1)

#GEX <- predict(M1, newdata = explanatory_data, type = "link", se= T)
#FEX <- exp(GEX$fit)
#FSEUP <- exp(GEX$fit + 1.96 * GEX$se.fit)
#FSELOW <- exp(GEX$fit - 1.96 * GEX$se.fit)
#lines(explanatory_data$openness, FEX, lty=1)


#plot(poolsum$openness, poolsum$n_seedlings, xlab ="Number of Seedlings", ylab = "Canopy Openness") +
#lines(explanatory_data$openness, FEX, lty=1) +
#lines(explanatory_data$openness, FSEUP, lty = 2) +
# lines(explanatory_data$openness, FSELOW, lty = 2)


```

#as you move into using glmmadmb, use this link https://rdrr.io/github/bbolker/glmmadmb/man/glmm.admb.html

#for glmmTMB use: 
https://cran.r-project.org/web/packages/glmmTMB/vignettes/glmmTMB.pdf 




```{r "lets write() a table for Josh"}

meta_dat <- bigbigdat %>% summarize(photo_number, Plot, stand, transect, position, row, n_seedlings, slope_aspect, latitude_0_s, longitude_0_w, altitude, gap_fraction, openness, lai_2000_lin, ppfd_total_under_per_day_m_jor_mol_m2day)

meta_dat <- rename(meta_dat, "plot_id" = "Plot" )

cps3 <- read.csv("C:/Users/gn238/OneDrive - Mississippi State University/R - Copy/r_pull_from/cps3.csv") %>% janitor::clean_names()
cps4 <- read.csv("C:/Users/gn238/OneDrive - Mississippi State University/R - Copy/r_pull_from/cps4.csv") %>% janitor::clean_names()
cps5 <- read.csv("C:/Users/gn238/OneDrive - Mississippi State University/R - Copy/r_pull_from/cps5.csv") %>% janitor::clean_names()
cps6 <- read.csv("C:/Users/gn238/OneDrive - Mississippi State University/R - Copy/r_pull_from/cps6.csv") %>% janitor::clean_names()
cps7 <- read.csv("C:/Users/gn238/OneDrive - Mississippi State University/R - Copy/r_pull_from/cps7.csv") %>% janitor::clean_names()
cps8 <- read.csv("C:/Users/gn238/OneDrive - Mississippi State University/R - Copy/r_pull_from/cps8.csv") %>% janitor::clean_names()
cps9 <- read.csv("C:/Users/gn238/OneDrive - Mississippi State University/R - Copy/r_pull_from/cps9.csv") %>% janitor::clean_names()
cps10<- read.csv("C:/Users/gn238/OneDrive - Mississippi State University/R - Copy/r_pull_from/cps10.csv") %>% janitor::clean_names()

      cps3 <- cps3 %>%  
    mutate(dried_weight_g = as.numeric(dried_weight_g))
        cps4 <- cps4 %>%  
    mutate(dried_weight_g = as.numeric(dried_weight_g))
        cps5 <- cps5 %>%  
    mutate(dried_weight_g = as.numeric(dried_weight_g))
        cps6 <- cps6 %>%  
    mutate(dried_weight_g = as.numeric(dried_weight_g))
        cps7 <- cps7 %>%  
    mutate(dried_weight_g = as.numeric(dried_weight_g))
        cps8 <- cps8 %>%  
    mutate(dried_weight_g = as.numeric(dried_weight_g))
        cps9 <- cps9 %>%  
    mutate(dried_weight_g = as.numeric(dried_weight_g))
        cps10 <- cps10 %>%  
    mutate(dried_weight_g = as.numeric(dried_weight_g))

all <- bind_rows(tibble(cps3), tibble(cps4))
all1 <- bind_rows(tibble(cps5), tibble(cps6))
all2 <- bind_rows(tibble(cps7), tibble(cps8))
all4 <- bind_rows(tibble(cps9), tibble(cps10))
allthestuff <- bind_rows(all, all1, all2, all4)


  

```

```{r}



SPlist <- allthestuff %>% select(species, species_code, changed_to_new_code_spp) %>% distinct(species_code)

sp_spelling <- read.csv("C:/Users/gn238/OneDrive - Mississippi State University/R - Copy/r_pull_from/sp_spelling.csv")

mastercode <- read.csv("C:/Users/gn238/OneDrive - Mississippi State University/R - Copy/r_pull_from/MASTER_PLANT_LIST.csv")

alldat <- allthestuff %>% left_join(sp_spelling, by = c("species_code", "changed_to_new_code_spp", "species"))

 

# mastercode = case_when(!grepl("UNK", "species_code") & is.na("species_code")~ "UNK")
meta_dat_cp <- alldat %>% left_join(meta_dat, by = "plot_id")
 
cps10 <- cps10 %>%  
    mutate(dried_weight_g = as.numeric(dried_weight_g))

 # mastercode = case_when(!is.na(changed_to_the_new_spp)~ change_to_new, TRUE ~ "species_code", species)


mastercode %>% distinct(species_code)


gn_metadat <- meta_dat_cp %>% summarise(photo_number, plot_id, stand, transect, position, row, n_seedlings, slope_aspect, latitude_0_s, longitude_0_w, altitude, gap_fraction, openness, lai_2000_lin, ppfd_total_under_per_day_m_jor_mol_m2day, species, species_code, dried_weight_g)

 # library("writexl")
 # write_xlsx(gn_metadat, "C:/Users/gn238/OneDrive - Mississippi State University/R - Copy/r_pull_from//gn_metadata.xlsx")

gn_metadat <- gn_metadat %>% mutate(species_code = recode(species_code, "ERCA" = "ERCN"))
gn_metadat <- gn_metadat %>% mutate(species_code = recode(species_code, "DIVI" = "DIVR"))

```


```{r "this is how you get the tables to pivot"}
BITEME<- read.csv("C:/Users/gn238/OneDrive - Mississippi State University/R - Copy/r_pull_from/gn_metadata_wzeros.csv")

library(tidyverse)

data_no_naBITEME <- BITEME %>% 
  filter(!is.na(species_code))

spp_dataBITEME <- data_no_naBITEME %>% 
  select(plot_id, species_code, dried_weight_g) %>%
  pivot_wider(names_from = species_code, values_from = dried_weight_g, values_fn = sum, values_fill = 0)

  
  #This is how I figured out which data were duplicated. 
  spp_data <- data_no_na %>% 
    select(plot_id, species_code, dried_weight_g) %>%  
    dplyr::group_by(plot_id, species_code) %>%
    dplyr::summarise(n = dplyr::n(), .groups = "drop") %>%
    dplyr::filter(n > 1L)

```


```{r "lets run some vegans out of town: this chunk includes [ALL] spp"}
library(vegan)
library(tidyverse)



data <- read_csv("C:/Users/gn238/Downloads/gn_metadata_wzeros.csv")

dat1 <-data %>% 
  filter(!is.na(species_code))

dat2 <- dat1 %>% 
  select(plot_id, species_code, dried_weight_g) %>%
  pivot_wider( names_from = species_code, values_from = dried_weight_g, values_fn = sum, values_fill = 0)

input_dat <- dat2 %>% column_to_rownames("plot_id")

# aRROW VECTORS MAN

z <- metaMDS(comm = input_dat,
             autotransform = FALSE,
             distance = "bray",
             engine = "monoMDS",
             k = 2,
             weakties = TRUE,
             model = "global",
             maxit = 300,
             try = 40,
             trymax = 120)
plot(z)


z$stress



varibs <- dat1 %>% summarise(plot_id, openness, lai_2000_lin, ppfd_total_under_per_day_m_jor_mol_m2day, gap_fraction, row, stand) %>%
 distinct()

varibs$standbyrow <- paste(varibs$stand, "_", varibs$row)


vinput <- varibs %>% column_to_rownames("plot_id")


env <- select(vinput, c(lai_2000_lin))
ef <- envfit(z, env, permu = 999, na.rm=TRUE) 
ef 


  


      ordiplot(z, type = "n")          #row type 
orditorp(z,display="species",col="red",air=0.01)
orditorp(z,display="sites", )
        ordihull(z,groups= varibs$row, draw="polygon",col="grey90",label=T)
               plot(ef)
        
              ordiplot(z, type = "n")       #Stand Number
orditorp(z,display="species",col="red",air=0.01)
orditorp(z,display="sites", )
        ordihull(z,groups= varibs$stand, draw="polygon",col="green4",label=T)
        
                      ordiplot(z, type = "n")  # Standbyrow
orditorp(z,display="species",col="red",air=0.01)
orditorp(z,display="sites", )
        ordihull(z,groups= varibs$standbyrow, draw="polygon",col="purple1",label=T)
        plot(ef)

              ordiplot(z, type = "n")  # Spider
              ordispider(z, groups=varibs$stand)
orditorp(z,display="species",col="red",air=0.01)
orditorp(z,display="sites")
       

          ordiplot(z, type = "n")  # Spider
              ordispider(z, groups=varibs$stand)
orditorp(z,display="species",col="red",air=0.01)
orditorp(z,display="sites", )
        



### ordiplot3d ###

library(vegan3d)

z_hel <- decostand(input_dat, method = "hellinger")

nmdsC <- metaMDS(comm = input_dat,
             autotransform = FALSE,
             distance = "bray",
             engine = "monoMDS",
             k = 3,
             weakties = TRUE,
             model = "global",
             maxit = 300,
             try = 40,
             trymax = 120)

nmdsD <- scores(nmdsC, choices = 1:3, display = c("species"))
nmdsD

nmdsC$stress
nmdsC$grstress
ord <- cca(input_dat)
out <- ordiplot3d(nmdsD, col = "red", ax.col= "black", pch = 18)

plot(ord)



# The following two lines will create a 3d graph of points and vectors#
ef <- envfit(ord ~ lai_2000_lin, vinput, choices = 1:3, na.rm=T)
ordiplot3d(nmdsD, col = "red", ax.col= "black", pch = 18, envfit = ef)
#this will add text to the points
text(out$xyz.convert(nmdsD), rownames(nmdsD), pos = 1)


### This is to plot some shapes within the point cloud ###


pl4 <- with(vinput, ordiplot3d(ord, pch=16))
ef <- envfit(ord ~ lai_2000_lin, vinput, choices = 1:3, na.rm=T)
ordiplot3d(nmdsD, col = "red", ax.col= "black", pch = 18, envfit = ef)
with(vinput, ordiellipse(pl4, vinput$row, draw = "poly", col = 1:2,
  alpha = 60))


### Here we plot in 3d with stands as shapes ###


pl4 <- with(vinput, ordiplot3d(ord, pch=16))
ef <- envfit(ord ~ lai_2000_lin, vinput, choices = 1:3, na.rm=T)
ordiplot3d(nmdsD, col = "red", ax.col= "black", pch = 18, envfit = ef)
with(vinput, ordiellipse(pl4, vinput$stand, draw = "poly", col = 1:2,
  alpha = 60))


### 1. use argument 'envfit' within ordiplot3d - documentation in function

# lets add some names to the points? #


ordiplot(z,type="n") #Ordination plot function especially for congested plots
orditorp(z,display="species",col="red",air=0.01) #The function adds text or points to ordination plots
orditorp(z,display="sites",cex=0.25,air=0.01)

```




```{r" Chunky monkey without stand 3"}



library(vegan)
library(tidyverse)



data <- read_csv("C:/Users/gn238/Downloads/gn_metadata_wzeros.csv")

dat1 <-data %>% 
  filter(!is.na(species_code)) 

dat1 %>%  filter(stand >=4)

no3_1 <- dat1 %>% 
  select(plot_id, species_code, dried_weight_g) %>%
  pivot_wider( names_from = species_code, values_from = dried_weight_g, values_fn = sum, values_fill = 0)

input_dat <- dat2 %>% column_to_rownames("plot_id")

# aRROW VECTORS MAN

z <- metaMDS(comm = input_dat,
             autotransform = FALSE,
             distance = "bray",
             engine = "monoMDS",
             k = 2,
             weakties = TRUE,
             model = "global",
             maxit = 300,
             try = 40,
             trymax = 120)
plot(z)


z$stress



varibs <- dat1 %>% summarise(plot_id, openness, lai_2000_lin, ppfd_total_under_per_day_m_jor_mol_m2day, gap_fraction, row, stand) %>%
 distinct()

varibs$standbyrow <- paste(varibs$stand, "_", varibs$row)


vinput <- varibs %>% column_to_rownames("plot_id")


env <- select(vinput, c(lai_2000_lin))
ef <- envfit(z, env, permu = 999, na.rm=TRUE) 
ef 


  


      ordiplot(z, type = "n")          #row type 
orditorp(z,display="species",col="red",air=0.01)
orditorp(z,display="sites", )
        ordihull(z,groups= varibs$row, draw="polygon",col="grey90",label=T)
               plot(ef)
        
              ordiplot(z, type = "n")       #Stand Number
orditorp(z,display="species",col="red",air=0.01)
orditorp(z,display="sites", )
        ordihull(z,groups= varibs$stand, draw="polygon",col="green4",label=T)
        
                      ordiplot(z, type = "n")  # Standbyrow
orditorp(z,display="species",col="red",air=0.01)
orditorp(z,display="sites", )
        ordihull(z,groups= varibs$standbyrow, draw="polygon",col="purple1",label=T)
        plot(ef)

              ordiplot(z, type = "n")  # Spider
              ordispider(z, groups=varibs$stand)
orditorp(z,display="species",col="red",air=0.01)
orditorp(z,display="sites", )
       
        raremin <- min(rowSums(input_dat))
        rarecurve(input_dat, raremin)
        

```












```{r "vegans that dont like their tofu cooked ~ rare ~ " }

setwd("C:/Users/gn238/Downloads/")
library(tidyverse)
library(vegan)
data <- read_csv("gn_metadata_wzeros.csv")


no_rare <- data %>% count(species_code) %>% filter(n>=5)


no_na_rare <- no_rare %>% 
  filter(!is.na(species_code))

test <- no_na_rare %>% left_join(data, by = "species_code")


nor_spp_data <- test %>% 
  select(plot_id, species_code, dried_weight_g) %>%
  pivot_wider( names_from = species_code, values_from = dried_weight_g, values_fn = sum, values_fill = 0)

nor_head <- nor_spp_data %>% column_to_rownames("plot_id")

B <- metaMDS(comm = input_dat,
             autotransform = FALSE,
             distance = "bray",
             engine = "monoMDS",
             k = 2,
             weakties = TRUE,
             model = "global",
             maxit = 300,
             try = 40,
             trymax = 120)
plot(B)


B$stress
### Vector ###
varibs_nor <- test %>% summarise(plot_id, openness, lai_2000_lin, ppfd_total_under_per_day_m_jor_mol_m2day, gap_fraction ) %>%
 distinct()

vinput_nor <- varibs_nor %>% column_to_rownames("plot_id")


env_nor <- select(vinput_nor, c(openness, lai_2000_lin, ppfd_total_under_per_day_m_jor_mol_m2day, gap_fraction))
ef_nor <- envfit(B, env_nor, permu = 999, na.rm=TRUE) 
ef_nor

plot(B) + plot(ef_nor)

```

```{r "permanova stuff}

# i deleted 7_10-E because i didnt have row defined and didnt know how to fix it

perm_weight <- input_dat %>% filter(!row_number() %in% c(94,95))

perm_ef <- varibs  %>% 
  filter(!is.na(openness))

perm_ef <- perm_ef %>% 
  filter(!is.na(row))

perm_ef %>%
     mutate(row=replace(row, NA, TO)) %>%
     as.data.frame()


seeded <- perm_ef %>% filter(stand== c(4,6,7,8))
unsee

adonis2(perm_weight ~ stand, data = perm_ef)


adonis2(perm_weight ~ standbyrow, data= perm_ef)

adonis2(perm_weight ~ row, data= seeded)

```

